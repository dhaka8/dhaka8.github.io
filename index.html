<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Abbas vs Patwary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;900&display=swap");

      :root {
        --grass: #4ade80;
        --soil: #78350f;
        --sky: #7dd3fc;
        --ui-yellow: #facc15;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--sky);
        background-image: radial-gradient(
          circle at 50% 50%,
          #bae6fd 0%,
          #7dd3fc 100%
        );
        overflow: hidden;
        touch-action: manipulation;
        color: #1e293b;
      }

      .font-bungee {
        font-family: "Bungee", cursive;
      }

      /* Classic Arcade UI */
      .arcade-card {
        background: white;
        border: 6px solid #1e293b;
        border-radius: 32px;
        box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.2);
      }

      .arcade-btn {
        background: #ef4444;
        color: white;
        border: 4px solid #7f1d1d;
        border-bottom-width: 8px;
        transition: all 0.1s;
        text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
      }

      .arcade-btn:active {
        border-bottom-width: 4px;
        transform: translateY(4px);
      }

      .char-btn {
        border: 6px solid #e2e8f0;
        background: #f8fafc;
        transition: all 0.2s;
      }

      .char-btn.selected {
        border-color: #4f46e5;
        background: #eef2ff;
        transform: scale(1.05);
      }

      /* Game Elements */
      .hole {
        position: relative;
        background: var(--soil);
        border: 6px solid #451a03;
        border-radius: 50%;
        aspect-ratio: 1/1;
        box-shadow:
          inset 0 15px 30px rgba(0, 0, 0, 0.6),
          0 8px 0px var(--grass);
        overflow: hidden;
        cursor: pointer;
      }

      .character {
        position: absolute;
        bottom: -110%;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        height: 90%;
        transition: bottom 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
      }

      .character img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
      }

      .hole.up .character {
        bottom: 10%;
      }

      /* Animations */
      @keyframes shake {
        0%,
        100% {
          transform: translate(0, 0);
        }
        20% {
          transform: translate(-8px, 0);
        }
        40% {
          transform: translate(8px, 0);
        }
        60% {
          transform: translate(-8px, 0);
        }
        80% {
          transform: translate(8px, 0);
        }
      }

      .screen-shake {
        animation: shake 0.3s ease-in-out;
      }

      @keyframes float-score {
        0% {
          opacity: 0;
          transform: translateY(0) scale(0.5);
        }
        20% {
          opacity: 1;
          transform: translateY(-20px) scale(1.2);
        }
        100% {
          opacity: 0;
          transform: translateY(-80px) scale(1);
        }
      }

      .score-popup {
        position: absolute;
        pointer-events: none;
        font-family: "Bungee";
        font-size: 2rem;
        animation: float-score 0.8s ease-out forwards;
        z-index: 100;
        text-shadow: 3px 3px 0px black;
      }

      .grass-blade {
        position: absolute;
        bottom: -5px;
        width: 100%;
        height: 20px;
        background: #22c55e;
        border-radius: 20px 20px 0 0;
        z-index: 10;
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen p-4">
    <!-- START SCREEN -->
    <div
      id="start-screen"
      class="screen w-full max-w-lg arcade-card p-8 text-center space-y-8 z-50"
    >
      <div>
        <h1 class="text-5xl font-bungee text-indigo-600 tracking-tighter">
          SMASH-UP!
        </h1>
        <p
          class="text-indigo-400 mt-2 font-bold uppercase tracking-widest text-sm"
        >
          Abbas vs Patwary
        </p>
      </div>

      <div class="space-y-4">
        <p class="text-gray-500 font-bold text-sm">PICK YOUR CANDIDATE</p>
        <div class="grid grid-cols-2 gap-6">
          <button
            onclick="selectChar('pat')"
            id="btn-pat"
            class="char-btn p-4 rounded-3xl flex flex-col items-center"
          >
            <img
              src="pat.png"
              alt="Pat"
              class="w-24 h-24 object-contain mb-2"
              onerror="
                this.src = 'https://api.dicebear.com/7.x/avataaars/svg?seed=Pat'
              "
            />
            <span class="font-bungee text-sm text-gray-700">Pat</span>
          </button>
          <button
            onclick="selectChar('abbas')"
            id="btn-abbas"
            class="char-btn p-4 rounded-3xl flex flex-col items-center"
          >
            <img
              src="abbas.png"
              alt="Abbas"
              class="w-24 h-24 object-contain mb-2"
              onerror="
                this.src =
                  'https://api.dicebear.com/7.x/avataaars/svg?seed=Abbas'
              "
            />
            <span class="font-bungee text-sm text-gray-700">Abbas</span>
          </button>
        </div>
        <p
          id="target-desc"
          class="text-xs text-gray-400 font-bold italic h-4"
        ></p>
      </div>

      <div class="pt-4 border-t-2 border-dashed border-gray-200">
        <p class="text-gray-400 text-[10px] font-black uppercase mb-1">
          Top Score
        </p>
        <p id="high-score-start" class="text-3xl font-bungee text-yellow-500">
          0
        </p>
      </div>

      <button
        onclick="startGame()"
        id="start-btn"
        class="w-full py-5 arcade-btn font-bungee text-2xl rounded-2xl shadow-xl disabled:opacity-30 disabled:cursor-not-allowed transition-all"
        disabled
      >
        BATTLE!
      </button>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden w-full max-w-2xl space-y-6">
      <!-- Stats Bar -->
      <div
        class="grid grid-cols-3 gap-4 items-center bg-white p-4 rounded-3xl border-4 border-slate-800 shadow-xl"
      >
        <div
          class="text-center bg-indigo-50 p-2 rounded-xl border-2 border-indigo-100"
        >
          <p class="text-[10px] text-indigo-400 font-black uppercase">Score</p>
          <p id="score-val" class="text-4xl font-bungee text-indigo-600">0</p>
        </div>
        <div class="text-center relative">
          <div
            id="combo-container"
            class="absolute -top-10 left-1/2 -translate-x-1/2 opacity-0 transition-all"
          >
            <p class="text-xs text-orange-500 font-black uppercase">COMBO</p>
            <p id="combo-val" class="text-2xl font-bungee text-orange-500">
              x0
            </p>
          </div>
          <p id="timer-val" class="text-5xl font-bungee text-red-500">30</p>
        </div>
        <div
          class="text-center bg-emerald-50 p-2 rounded-xl border-2 border-emerald-100"
        >
          <p class="text-[10px] text-emerald-400 font-black uppercase">Level</p>
          <p id="level-val" class="text-4xl font-bungee text-emerald-600">1</p>
        </div>
      </div>

      <!-- The Field -->
      <div class="grid grid-cols-3 gap-4 md:gap-8 game-container p-4" id="grid">
        <!-- Holes generated by JS -->
      </div>
    </div>

    <!-- END SCREEN -->
    <div
      id="end-screen"
      class="screen hidden w-full max-w-sm arcade-card p-10 text-center space-y-8 z-50"
    >
      <h2 class="text-5xl font-bungee text-red-600 -rotate-2">FINISH!</h2>

      <div class="bg-indigo-50 p-6 rounded-3xl border-4 border-indigo-100">
        <p class="text-indigo-400 uppercase font-black text-xs tracking-widest">
          Points Smashed
        </p>
        <p id="final-score" class="text-7xl font-bungee text-indigo-600 my-2">
          0
        </p>
        <p
          id="new-record"
          class="text-orange-500 font-bungee text-sm hidden animate-bounce"
        >
          NEW RECORD!
        </p>
      </div>

      <button
        onclick="location.reload()"
        class="w-full py-5 arcade-btn bg-indigo-600 border-indigo-900 font-bungee text-xl rounded-2xl shadow-xl transition-all"
      >
        PLAY AGAIN
      </button>
    </div>

    <script>
      // Sound Engine
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioCtx();

      const playSound = (freq, type, duration, vol = 0.1) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(vol, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(
          0.0001,
          ctx.currentTime + duration,
        );
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + duration);
      };

      const sounds = {
        hit: () => playSound(400, "square", 0.1, 0.1),
        penalty: () => {
          playSound(150, "sawtooth", 0.4, 0.2);
          playSound(100, "sawtooth", 0.4, 0.2);
        },
        levelUp: () => {
          playSound(523, "sine", 0.1, 0.1);
          setTimeout(() => playSound(659, "sine", 0.1, 0.1), 100);
          setTimeout(() => playSound(783, "sine", 0.2, 0.1), 200);
        },
        start: () => playSound(880, "sine", 0.3, 0.1),
        gameOver: () => {
          playSound(440, "square", 0.2, 0.1);
          setTimeout(() => playSound(330, "square", 0.2, 0.1), 200);
          setTimeout(() => playSound(220, "square", 0.5, 0.1), 400);
        },
      };

      const scoreBoard = document.querySelector("#score-val");
      const timerDisplay = document.querySelector("#timer-val");
      const levelDisplay = document.querySelector("#level-val");
      const comboDisplay = document.querySelector("#combo-val");
      const comboContainer = document.getElementById("combo-container");
      const grid = document.getElementById("grid");
      const startScreen = document.getElementById("start-screen");
      const gameScreen = document.getElementById("game-screen");
      const endScreen = document.getElementById("end-screen");

      let lastHole;
      let timeUp = false;
      let score = 0;
      let combo = 0;
      let level = 1;
      let selectedCharacter = null;
      let timeLeft = 30;

      // Initialize High Score
      const savedHigh = localStorage.getItem("arcade_smash_high") || 0;
      document.getElementById("high-score-start").textContent = savedHigh;

      // Generate Grid
      for (let i = 0; i < 9; i++) {
        const hole = document.createElement("div");
        hole.className = "hole";
        hole.innerHTML =
          '<div class="character"></div><div class="grass-blade"></div>';
        hole.addEventListener("mousedown", (e) => whack(e, hole));
        hole.addEventListener("touchstart", (e) => {
          e.preventDefault();
          whack(e, hole);
        });
        grid.appendChild(hole);
      }
      const holes = document.querySelectorAll(".hole");

      function selectChar(char) {
        ctx.resume(); // Resume audio context on user interaction
        selectedCharacter = char;
        document
          .querySelectorAll(".char-btn")
          .forEach((b) => b.classList.remove("selected"));
        document.getElementById(`btn-${char}`).classList.add("selected");
        document.getElementById("start-btn").disabled = false;

        const target = char === "pat" ? "Abbas" : "Pat";
        document.getElementById("target-desc").textContent =
          `Smash ${target}! Don't hit yourself!`;
        sounds.start();
      }

      function randomTime(min, max) {
        return Math.round(Math.random() * (max - min) + min);
      }

      function randomHole(holes) {
        const idx = Math.floor(Math.random() * holes.length);
        const hole = holes[idx];
        if (hole === lastHole) return randomHole(holes);
        lastHole = hole;
        return hole;
      }

      function peep() {
        const baseMin = Math.max(150, 700 - level * 50);
        const baseMax = Math.max(350, 1200 - level * 70);

        const time = randomTime(baseMin, baseMax);
        const hole = randomHole(holes);
        const charDiv = hole.querySelector(".character");

        const isFriendly = Math.random() < 0.25; // 25% chance for own char
        const charToShow = isFriendly
          ? selectedCharacter
          : selectedCharacter === "pat"
            ? "abbas"
            : "pat";

        charDiv.innerHTML = `<img src="${charToShow}.png" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=${charToShow}'">`;
        hole.dataset.type = isFriendly ? "friend" : "enemy";
        hole.classList.add("up");

        setTimeout(() => {
          hole.classList.remove("up");
          if (!timeUp) peep();
        }, time);
      }

      function startGame() {
        startScreen.classList.add("hidden");
        gameScreen.classList.remove("hidden");

        score = 0;
        combo = 0;
        level = 1;
        timeLeft = 30;
        timeUp = false;

        updateScoreUI();
        peep();

        // Add extra peeps as difficulty increases
        const extraPeepTimer = setInterval(() => {
          if (timeUp) clearInterval(extraPeepTimer);
          if (level >= 4) peep();
        }, 5000);

        const countdown = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = timeLeft;
          if (timeLeft <= 5) {
            timerDisplay.classList.add("animate-pulse");
            playSound(600, "sine", 0.05, 0.05);
          }
          if (timeLeft <= 0) {
            clearInterval(countdown);
            timeUp = true;
            showEndScreen();
          }
        }, 1000);
      }

      function whack(e, hole) {
        if (e.type === "mousedown" && e.which !== 1) return; // Only left click
        if (!hole.classList.contains("up")) return;

        const isFriend = hole.dataset.type === "friend";
        const clientX = e.touches ? e.touches[0].clientX : e.pageX;
        const clientY = e.touches ? e.touches[0].clientY : e.pageY;

        if (isFriend) {
          score = Math.max(0, score - 5);
          combo = 0;
          sounds.penalty();
          document.body.classList.add("screen-shake");
          createPopup(clientX, clientY, "OOPS!", "text-red-600");
          setTimeout(() => document.body.classList.remove("screen-shake"), 300);
        } else {
          combo++;
          const bonus = Math.floor(combo / 5);
          const points = 1 + bonus;
          score += points;
          sounds.hit();
          createPopup(clientX, clientY, `+${points}`, "text-indigo-600");

          if (score > 0 && score % 15 === 0) {
            level++;
            sounds.levelUp();
          }
        }

        hole.classList.remove("up");
        updateScoreUI();
      }

      function updateScoreUI() {
        scoreBoard.textContent = score;
        levelDisplay.textContent = level;
        comboDisplay.textContent = `x${combo}`;
        comboContainer.style.opacity = combo > 2 ? "1" : "0";
        comboContainer.style.transform = `translateX(-50%) scale(${1 + combo * 0.05})`;
      }

      function createPopup(x, y, text, colorClass) {
        const p = document.createElement("div");
        p.className = `score-popup ${colorClass}`;
        p.style.left = `${x}px`;
        p.style.top = `${y}px`;
        p.textContent = text;
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 800);
      }

      function showEndScreen() {
        sounds.gameOver();
        gameScreen.classList.add("hidden");
        endScreen.classList.remove("hidden");
        document.getElementById("final-score").textContent = score;

        const high = localStorage.getItem("arcade_smash_high") || 0;
        if (score > high) {
          localStorage.setItem("arcade_smash_high", score);
          document.getElementById("new-record").classList.remove("hidden");
        }
      }
    </script>
  </body>
</html>
